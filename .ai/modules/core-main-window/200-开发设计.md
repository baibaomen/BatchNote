# 开发设计：core-main-window

## UI 设计

### 整体布局

```
┌─────────────────────────────────────────────────────────────┐
│  BatchNote                                        [_][□][×] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ☑ [1]                                            [×] │   │
│  │ ┌─────────┐  ┌───────────────────────────────────┐  │   │
│  │ │         │  │                                   │  │   │
│  │ │ 缩略图  │  │  文本框                           │  │   │
│  │ │         │  │  对这张截图的意见...              │  │   │
│  │ └─────────┘  └───────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ☑ [2]                                            [×] │   │
│  │ ┌───────────────────────────────────────────────┐   │   │
│  │ │  纯文本条目（无图片）                          │   │   │
│  │ │  用于自发的思考和要求...                       │   │   │
│  │ └───────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  （更多条目...可滚动）                                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [+ 文本] [合成大图] [复制到剪贴板] [历史记录] [清空]        │
└─────────────────────────────────────────────────────────────┘
```

### 条目类型

1. **图片条目**：左侧缩略图 + 右侧文本框
2. **纯文本条目**：仅文本框，用于自发的思考和要求

### 交互流程

1. 热键呼出窗口（TopMost）
2. Ctrl+V 粘贴截图 → 自动添加图片条目 → 聚焦文本框
3. 点击 [+ 文本] → 添加纯文本条目 → 聚焦文本框
4. 拖拽条目排序
5. 勾选/取消勾选条目
6. 点击 × 删除条目
7. 点击 [合成大图] → 合成勾选的条目
8. 点击 [复制到剪贴板]

## 接口设计

### MainForm

```csharp
public partial class MainForm : Form
{
    // 条目列表
    private List<ScreenshotEntry> _entries;
    
    // 公开方法
    public void AddImageEntry(Bitmap image);
    public void AddTextEntry();
    public void RemoveEntry(int index);
    public void MoveEntry(int fromIndex, int toIndex);
    public void ClearAllEntries();
    public List<ScreenshotEntry> GetCheckedEntries();
    
    // 事件
    public event EventHandler<CompositeRequestedEventArgs> CompositeRequested;
    public event EventHandler CopyToClipboardRequested;
}
```

### ScreenshotEntryControl（自定义控件）

```csharp
public class ScreenshotEntryControl : UserControl
{
    // 属性
    public int Index { get; set; }
    public bool IsChecked { get; set; }
    public ScreenshotEntry Entry { get; set; }
    
    // 事件
    public event EventHandler DeleteClicked;
    public event EventHandler CheckedChanged;
    public event EventHandler ThumbnailHovered;
    public event EventHandler<DragEventArgs> EntryDragged;
}
```

## 数据结构

见 Models/ScreenshotEntry.cs

## 设计决策

1. **使用 FlowLayoutPanel 作为条目容器** — 简单直观，自动处理布局
2. **条目控件高度固定** — 缩略图统一 120x90，文本框多行但限高
3. **TopMost 模式** — 始终置顶，便于在阅读AI输出时快速操作
4. **粘贴后自动聚焦** — 提升连贯输入体验
